<app-header></app-header>

<section class="app-shell">
  <div class="app-section__header">
    <p class="app-section__subtitle">Catalog</p>
    <h2 class="app-section__title">Manage and browse inventory</h2>
          </div>

  <div class="app-alert" *ngIf="message" [ngClass]="getMessageClass()">
    {{ message }}
            </div>

  <article class="app-card" *ngIf="userRole !== 'user'">
    <h3>Add a new product</h3>
    <form #myForm="ngForm" (ngSubmit)="myForm.form.valid ? postData(myForm) : ''">
      <div class="form-grid">
        <input
          class="form-control"
          type="text"
          #name="ngModel"
          name="name"
          [(ngModel)]="userData.name"
          placeholder="Product name"
          required
          minlength="4">

        <select
          class="form-control"
          name="catID"
          #catID="ngModel"
          [(ngModel)]="userData.catID"
          required>
          <option value="" disabled selected>Select category</option>
          <option *ngFor="let cat of catDropdown" [value]="cat.id">{{ cat.name }}</option>
        </select>

        <input
          class="form-control"
          type="text"
          #description="ngModel"
          name="description"
          [(ngModel)]="userData.description"
          placeholder="Description"
          required
          minlength="4">

        <input
          class="form-control"
          type="number"
          #price="ngModel"
          name="price"
          [(ngModel)]="userData.price"
          placeholder="Price"
          required
          min="0">
                </div>
      <div class="app-card__actions">
        <button class="app-btn" type="submit" [disabled]="myForm.invalid">Create product</button>
            </div>
  </form>
  </article>

  <div class="app-card app-card__actions">
    <div class="app-section__subtitle">View</div>
    <button class="app-btn app-btn--ghost" type="button" (click)="onClickChange()">
      {{ isUserSeeGrid ? 'Switch to table view' : 'Switch to grid view' }}
    </button>
          </div>

  <div class="app-grid" *ngIf="isUserSeeGrid; else tableView">
    <article class="app-card" *ngFor="let data of usersDataFromDatabase; let i = index">
      <div class="app-section__header">
        <h3>{{ data.name }}</h3>
        <p class="app-section__subtitle">{{ data.category }}</p>
      </div>
      <p>{{ data.description }}</p>
      <div class="app-metric">
        <span class="app-metric__label">Price</span>
        <span class="app-metric__value">{{ data.price | currency:'USD':'symbol':'1.2-2' }}</span>
      </div>
      <div class="app-card__actions">
        <button class="app-btn" type="button" *ngIf="userRole === 'user'" (click)="addToCart(data.price,data.id)">
          Add to cart
        </button>
        <button
          class="app-btn app-btn--ghost"
          type="button"
          *ngIf="userRole !== 'user'"
          (click)="openModal(data.id,data.name,data.description,data.price,data.categoryId)">
          Update
        </button>
        <button
          class="app-btn app-btn--ghost"
          type="button"
          *ngIf="userRole !== 'user'"
          (click)="productDelete(data.id)">
          Delete
        </button>
      </div>
      <div class="app-card__actions" *ngIf="userRole !== 'user'">
        <span class="app-pill" [class.app-alert--success]="productStatus()[i]">
          {{ productStatus()[i] ? 'Active' : 'Inactive' }}
        </span>
          <label class="switch">
            <input type="checkbox" (click)="changeInput(data.id,data.status)" [checked]="data.status === 1">
            <span class="slider round"></span>
          </label>
      </div>
    </article>
  </div>

  <ng-template #tableView>
    <div class="app-table-wrapper">
      <table class="app-table">
        <thead>
    <tr>
      <th [hidden]="userRole==='user'">ID</th>
            <th>Name</th>
            <th>Category</th>
            <th>Description</th>
            <th>Price</th>
            <th [hidden]="userRole!=='user'">Add to cart</th>
      <th [hidden]="userRole==='user'">Actions</th>
            <th [hidden]="userRole==='user'">Status</th>
    </tr>
        </thead>
        <tbody>
          <tr *ngFor="let person of usersDataFromDatabase">
      <td [hidden]="userRole==='user'">{{ person.id }}</td>
            <td>{{ person.name }}</td>
            <td>{{ person.category }}</td>
            <td>{{ person.description }}</td>
            <td>{{ person.price | currency:'USD':'symbol':'1.2-2' }}</td>
            <td [hidden]="userRole!=='user'">
              <button class="app-btn app-btn--ghost" type="button" (click)="addToCart(person.price,person.id)">
                Add to cart
              </button>
            </td>
            <td [hidden]="userRole==='user'">
              <div class="app-card__actions">
                <button class="app-btn app-btn--ghost" type="button"
                  (click)="openModal(person.id,person.name,person.description,person.price,person.categoryId)">
                  Update
                </button>
                <button class="app-btn app-btn--ghost" type="button" (click)="productDelete(person.id)">
                  Delete
                </button>
              </div>
      </td>
      <td [hidden]="userRole==='user'">
        <label class="switch">
          <input type="checkbox" (click)="changeInput(person.id,person.status)" [checked]="person.status === 1">
          <span class="slider round"></span>
        </label>
      </td>
          </tr>
        </tbody>
      </table>
    </div>
  </ng-template>

      <div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':display}">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
          <h4 class="modal-title">Edit product</h4>
          <button type="button" class="close" aria-label="Close" (click)="onCloseHandled()">
            <span aria-hidden="true">&times;</span>
          </button>
            </div>
            <div class="modal-body">
          <form #myForm="ngForm" (ngSubmit)="UpdateProduct(productData!.ProductId,myForm)" *ngIf="productData">
            <div class="form-grid">
              <input class="form-control" type="text" #name2="ngModel" name="name"
                  [(ngModel)]="userData.name2" required minlength="4">
              <select name="catID2" #catID2="ngModel" [(ngModel)]="userData.catID2" required>
                <option *ngFor="let cat of catDropdown" [value]="cat.id">{{ cat.name }}</option>
                  </select>
              <input class="form-control" type="text" #description2="ngModel" name="description"
                      [(ngModel)]="userData.description2" required minlength="4">
              <input class="form-control" type="number" #price2="ngModel" name="price2"
                [(ngModel)]="userData.price2" required minlength="1">
            </div>
            <div class="app-card__actions">
              <button class="app-btn" type="submit" [disabled]="myForm.invalid">Save changes</button>
            </div>
          </form>
          </div>
        <div class="modal-footer">
          <button type="button" class="app-btn app-btn--ghost" (click)="onCloseHandled()">Close</button>
        </div>
      </div>
    </div>
</div>
</section>
